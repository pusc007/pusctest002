(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{401:function(t,e,n){},403:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-dialog",{attrs:{persistent:"","max-width":"300px"},model:{value:t.alert,callback:function(e){t.alert=e},expression:"alert"}},[n("v-card",{staticClass:"pa-4",attrs:{light:""}},[n("v-card-text",{staticClass:"text-center"},[t._v(" "+t._s(t.message))]),t._v(" "),n("v-card-actions",{staticClass:"justify-center"},[n("v-btn",{attrs:{depressed:""},on:{click:t.cancelBtn_click}},[t._v("\n        取消\n      ")]),t._v(" "),n("v-btn",{attrs:{depressed:"",color:"cyan white--text"},on:{click:t.certainBtn_click}},[t._v("\n        確定\n      ")])],1)],1)],1)};s._withStripped=!0;var i={components:{},data:function(){return{alert:!1,message:"",certainFun:null,cancelFun:null}},mounted:function(){},methods:{run:function(t,e,n){this.alert=!0,this.message=t,this.certainFun=e,this.cancelFun=n},cancelBtn_click:function(){this.alert=!1,this.cancelFun()},certainBtn_click:function(){this.alert=!1,this.certainFun()}},computed:{}},a=n(115),r=Object(a.a)(i,s,[],!1,null,"6fce52e9",null);r.options.__file="src/vue/components/Confirm.vue";e.a=r.exports},406:function(t,e,n){"use strict";n(401)},407:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"calendar"},[t._l(7,(function(e,s){return n("div",{key:"weekday"+s,staticClass:"weekday"},[t._v(t._s(t.weekdayText[s]))])})),t._v(" "),t._l(t.days,(function(e,s){return n("div",{key:"item"+s,staticClass:"date",class:{present:"present"===e.status,presentMonth:e.presentMonth}},[n("div",{staticClass:"label"},[t._v(t._s(e.date.M)+"/"+t._s(e.date.D))]),t._v(" "),n("div",{staticClass:"content"},[t._t("content",null,{item:Object.assign({},e,t.getItem(e.date.Y,e.date.M,e.date.D))})],2)])}))],2)])};function i(t){return{Y:t.getFullYear(),M:t.getMonth()+1,D:t.getDate()}}function a(t,e){for(var n=[],s=new Date(t,e-1,1),a=s.getDay(),r=0;r<a;r++)s.setFullYear(t,e-1,1-a+r),n.push(new Date(s));for(var o=function(t,e){return new Date(t,e,0).getDate()}(t,e),c=0;c<o;c++)s.setFullYear(t,e-1,c+1),n.push(new Date(s));for(var l=0;l<42-o-a;l++)s.setFullYear(t,e,l+1),n.push(new Date(s));function u(t){return 1e4*t.Y+100*t.M+t.D}var h=u(i(new Date));return n=n.map((function(t){var n=(t=i(t)).M===e,s=u(t),a="";return s<h?a="past":s==h?a="present":s>h&&(a="future"),{date:t,status:a,presentMonth:n}}))}s._withStripped=!0;var r=new Date,o={components:{},props:{year:{type:[String,Number],default:r.getFullYear()},month:{type:[String,Number],default:r.getMonth()+1},items:{type:[Array],default:function(){return[]}}},data:function(){return{weekdayText:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],days:a(this.year,this.month)}},watch:{year:function(t){this.days=a(this.year,this.month)},month:function(t){this.days=a(this.year,this.month)}},mounted:function(){},methods:{getItem:function(t,e,n){var s="".concat(t,"-").concat(e.toString().padStart(2,"0"),"-").concat(n.toString().padStart(2,"0")),i=this.items.filter((function(t){return t.dateTimeRange.substr(0,10)===s}));return i.length?{bool:!0,list:i,date:s}:{bool:!1,date:s}}},computed:{}},c=(n(406),n(115)),l=Object(c.a)(o,s,[],!1,null,"0ad61136",null);l.options.__file="src/vue/components/Calendar.vue";e.a=l.exports},424:function(t,e,n){},425:function(t,e,n){},455:function(t,e,n){"use strict";n(424)},456:function(t,e,n){"use strict";n(425)},462:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-sheet",{staticClass:"content"},[t.infoLoading?t._e():[n("Header"),t._v(" "),n("v-main",{staticClass:"main"},[n("v-container",[n("div",{staticClass:"d-flex justify-center ma-4"},[t._v("請依序選擇 檢測站點 > 可預約日期")]),t._v(" "),n("v-select",{staticClass:"mt-4",attrs:{color:"cyan",items:t.siteList,label:"檢測站點",loading:t.siteLoading},on:{click:t.site_click,change:t.site_change},scopedSlots:t._u([{key:"no-data",fn:function(){return[n("div",{staticClass:"pa-2"},[t._v(t._s(t.siteLoading?"載入中...":"空資料"))])]},proxy:!0},{key:"selection",fn:function(e){var s=e.item;return[n("div",{staticClass:"text-truncate"},[t._v(t._s(s.text))])]}},{key:"item",fn:function(e){var s=e.item,i=e.attrs,a=e.on;return[n("v-list-item",t._g(t._b({},"v-list-item",i,!1),a),[n("v-list-item-content",[n("v-list-item-title",{attrs:{id:i["aria-labelledby"]},domProps:{textContent:t._s(s.text)}})],1)],1)]}}],null,!1,3473734003),model:{value:t.siteValue,callback:function(e){t.siteValue=e},expression:"siteValue"}}),t._v(" "),t.siteValue?n("v-toolbar",{staticClass:"d-flex justify-center",attrs:{flat:""}},[t.prevBool?n("v-btn",{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:t.prev}},[n("v-icon",{attrs:{small:""}},[t._v("\n              mdi-chevron-left\n            ")])],1):t._e(),t._v(" "),n("v-toolbar-title",[t._v(" "+t._s(t.selectYear)+" 年 "+t._s(t.selectMonth)+" 月")]),t._v(" "),t.nextBool?n("v-btn",{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:t.next}},[n("v-icon",{attrs:{small:""}},[t._v("\n              mdi-chevron-right\n            ")])],1):t._e()],1):t._e(),t._v(" "),t.siteValue?[t.siteDateLoading?n("div",{staticClass:"d-flex justify-center text-h6"},[t._v("載入中...")]):n("Calendar",{attrs:{year:t.selectYear,month:t.selectMonth,items:t.openDate},scopedSlots:t._u([{key:"content",fn:function(e){return[n("div",{staticClass:"dateBox pa-2"},[e.item.presentMonth&&e.item.bool?n("div",{staticClass:"dateInfo d-flex align-center justify-center"},[n("v-btn",{staticClass:"cyan white--text",attrs:{depressed:""},on:{click:function(n){return t.reservationBtn_click(e.item)}}},[t._v("\n                    預約\n                  ")])],1):t._e()])]}}],null,!1,4009778730)})]:t._e()],2)],1),t._v(" "),n("v-dialog",{attrs:{"max-width":"300px"},model:{value:t.selectTimeRange,callback:function(e){t.selectTimeRange=e},expression:"selectTimeRange"}},[n("v-card",{staticClass:"pa-4",attrs:{light:""}},[n("v-card-text",{staticClass:"text-center"},[n("v-list",[n("v-list-item-group",t._l(t.openDateTime,(function(e,s){return n("v-list-item",{key:s,on:{click:function(n){return t.reservationBtnGo_click(e)}}},[n("v-list-item-content",[n("div",[t._v(t._s(e.dateTimeRange))]),t._v(" "),n("div",[t._v("已預約："+t._s(e.count))]),t._v(" "),n("div",[t._v("尚可預約："+t._s(e.maxcount-e.count))])])],1)})),1)],1)],1),t._v(" "),n("v-card-actions",{staticClass:"justify-center"},[n("v-btn",{attrs:{depressed:""},on:{click:t.cancelBtn_click}},[t._v("\n            取消\n          ")])],1)],1)],1),t._v(" "),n("Confirm",{ref:"confirm"}),t._v(" "),n("v-overlay",{attrs:{value:t.running}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"64"}},[t._v("執行中...")])],1)],t._v(" "),n("v-overlay",{attrs:{value:t.infoLoading}},[n("v-progress-circular",{attrs:{indeterminate:"",size:"64"}},[t._v("載入資訊中...")])],1)],2)};s._withStripped=!0;var i=n(402),a=n(407),r=n(403),o=n(399),c={mixins:[n(400).a],components:{Header:i.a,Calendar:a.a,Confirm:r.a},data:function(){return{infoLoading:!1,siteList:[],siteValue:"",siteLoading:!1,selectYear:null,selectMonth:null,running:!1,siteDateLoading:!1,api_sites_promise:null,api_searchOpentimes_promise:null,openDate:[],selectTimeRange:!1,openDateTime:[],prevBool:!1,nextBool:!1,dateRangeS:"",dateRangeE:""}},mounted:function(){var t=this;this.$store.state.info?this.init(this.$store.state.info):(this.infoLoading=!0,Object(o.j)(this.$store.state.token).then((function(e){t.infoLoading=!1,t.$store.dispatch("setInfo",e),t.$store.state.isInfo=!0,t.init(e)})).catch((function(e){t.infoLoading=!1,t.errorAction(e)})))},methods:{init:function(t){if(t.contactName&&t.contactPhone&&t.contactEmail)if(t.reDateTimeRange||t.exDateTimeRange||t.city)this.$router.push({name:"Info"});else{var e=t.reDateRange.split("~"),n=e[0].substr(0,7),s=e[1].substr(0,7);this.dateRangeS=this.dateStrToInt(n.replace("-","")),this.dateRangeE=this.dateStrToInt(s.replace("-","")),this.selectYear=parseInt(n.substr(0,4)),this.selectMonth=parseInt(n.substr(5,2));var i=this.dateStrToInt(this.dateChangeStr(this.selectYear,this.selectMonth));this.prevBool=i>this.dateRangeS,this.nextBool=i<this.dateRangeE}else this.$router.push({name:"Contact"})},dateChangeStr:function(t,e){return"".concat(t,"-").concat(e.toString().padStart(2,"0"))},dateStrToInt:function(t){return parseInt(t.replace("-",""))},site_click:function(){var t=this;this.api_sites_promise&&(this.api_sites_promise.cancel(),this.api_sites_promise=null),this.siteValue="",this.siteList=[],this.siteLoading=!0,this.api_sites_promise=Object(o.h)(this.$store.state.token),this.api_sites_promise.then((function(e){t.siteLoading=!1,t.siteList=e.map((function(t){return{id:t.id,text:t.sitename}}))}))},updateStationDate:function(){var t=this,e=new Date(this.dateChangeStr(this.selectYear,this.selectMonth)+"-01"),n=new Date(this.dateChangeStr(this.selectYear+(12===this.selectMonth?1:0),(12===this.selectMonth?0:this.selectMonth)+1)+"-01");n.setDate(0),this.api_searchOpentimes_promise&&(this.api_searchOpentimes_promise.cancel(),this.api_searchOpentimes_promise=null),this.siteDateLoading=!0,this.api_searchOpentimes_promise=Object(o.g)(this.$store.state.token,"redate",this.siteValue,e,n),this.api_searchOpentimes_promise.then((function(e){t.siteDateLoading=!1,t.openDate=e}))},prev:function(){var t=new Date(this.dateChangeStr(this.selectYear,this.selectMonth)+"-01");t.setMonth(t.getMonth()-1),this.selectYear=t.getFullYear(),this.selectMonth=t.getMonth()+1;var e=this.dateStrToInt(this.dateChangeStr(this.selectYear,this.selectMonth));this.prevBool=e>this.dateRangeS,this.nextBool=e<this.dateRangeE,this.updateStationDate()},next:function(){var t=new Date(this.dateChangeStr(this.selectYear,this.selectMonth)+"-01");t.setMonth(t.getMonth()+1),this.selectYear=t.getFullYear(),this.selectMonth=t.getMonth()+1;var e=this.dateStrToInt(this.dateChangeStr(this.selectYear,this.selectMonth));this.prevBool=e>this.dateRangeS,this.nextBool=e<this.dateRangeE,this.updateStationDate()},reservationBtn_click:function(t){var e=this;this.running=!0,this.openDateTime=[],Object(o.f)(this.$store.state.token,"redate",this.siteValue,new Date(t.date)).then((function(t){e.running=!1,e.openDateTime=t,e.selectTimeRange=!0})).catch((function(t){e.running=!1,e.errorAction(t)}))},reservationBtnGo_click:function(t){var e=this;this.$refs.confirm.run("確定預約 ".concat(t.dateTimeRange," ?"),(function(){e.running=!0,Object(o.e)(e.$store.state.token,e.siteValue,t.dateTimeRange).then((function(){e.running=!1,e.$store.dispatch("setReserv",{site:e.siteValue,reDateTimeRange:t.dateTimeRange}),e.$router.push({name:"Info"})})).catch((function(t){e.running=!1,e.errorAction(t)}))}),(function(){}))},site_change:function(){this.updateStationDate()},cancelBtn_click:function(){this.selectTimeRange=!1}},computed:{}},l=(n(455),n(456),n(115)),u=Object(l.a)(c,s,[],!1,null,"2056fb8f",null);u.options.__file="src/vue/pages/Reservation.vue";e.default=u.exports}}]);