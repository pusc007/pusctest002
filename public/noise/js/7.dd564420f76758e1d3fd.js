(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{421:function(t,e,i){},422:function(t,e,i){},472:function(t,e,i){"use strict";i(421)},473:function(t,e,i){"use strict";i(422)},477:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-sheet",{staticClass:"content"},[i("Header"),t._v(" "),i("v-main",{staticClass:"main"},[i("v-container",[i("div",{staticClass:"d-flex justify-center ma-4"},[t._v("請依序選擇 縣市 > 檢測站點 > 可預約日期")]),t._v(" "),i("v-select",{staticClass:"mt-4",attrs:{color:"cyan",items:t.cityList,label:"縣市",loading:t.cityLoading},on:{click:t.city_click,change:t.city_change},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("div",{staticClass:"pa-2"},[t._v(t._s(t.cityLoading?"載入中...":"空資料"))])]},proxy:!0},{key:"selection",fn:function(e){var s=e.item;return[i("div",{staticClass:"text-truncate"},[t._v(t._s(s.text))])]}},{key:"item",fn:function(e){var s=e.item,n=e.attrs,a=e.on;return[i("v-list-item",t._g(t._b({},"v-list-item",n,!1),a),[i("v-list-item-content",[i("v-list-item-title",{attrs:{id:n["aria-labelledby"]},domProps:{textContent:t._s(s.text)}})],1)],1)]}}]),model:{value:t.cityValue,callback:function(e){t.cityValue=e},expression:"cityValue"}}),t._v(" "),t.cityValue?i("v-select",{staticClass:"mt-4",attrs:{color:"cyan",items:t.siteList,label:"檢測站點",loading:t.siteLoading},on:{click:t.site_click,change:t.site_change},scopedSlots:t._u([{key:"no-data",fn:function(){return[i("div",{staticClass:"pa-2"},[t._v(t._s(t.siteLoading?"載入中...":"空資料"))])]},proxy:!0},{key:"selection",fn:function(e){var s=e.item;return[i("div",{staticClass:"text-truncate"},[t._v(t._s(s.text))])]}},{key:"item",fn:function(e){var s=e.item,n=e.attrs,a=e.on;return[i("v-list-item",t._g(t._b({},"v-list-item",n,!1),a),[i("v-list-item-content",[i("v-list-item-title",{attrs:{id:n["aria-labelledby"]},domProps:{textContent:t._s(s.text)}})],1)],1)]}}],null,!1,3473734003),model:{value:t.siteValue,callback:function(e){t.siteValue=e},expression:"siteValue"}}):t._e(),t._v(" "),t.cityValue&&t.siteValue?i("v-toolbar",{staticClass:"d-flex justify-center",attrs:{flat:""}},[i("v-btn",{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:t.prev}},[i("v-icon",{attrs:{small:""}},[t._v("\n            mdi-chevron-left\n          ")])],1),t._v(" "),i("v-toolbar-title",[t._v(" "+t._s(t.selectYear)+" 年 "+t._s(t.selectMonth)+" 月")]),t._v(" "),i("v-btn",{attrs:{fab:"",text:"",small:"",color:"grey darken-2"},on:{click:t.next}},[i("v-icon",{attrs:{small:""}},[t._v("\n            mdi-chevron-right\n          ")])],1)],1):t._e(),t._v(" "),t.cityValue&&t.siteValue?[t.siteDateLoading?i("div",{staticClass:"d-flex justify-center text-h6"},[t._v("載入中...")]):i("Calendar",{attrs:{year:t.selectYear,month:t.selectMonth,items:t.openDate},scopedSlots:t._u([{key:"content",fn:function(e){return[i("div",{staticClass:"dateBox pa-2"},["past"!==e.item.status&&e.item.presentMonth&&e.item.bool?i("div",{staticClass:"dateInfo"},[i("div",{staticClass:"text"},[i("div",[t._v("已預約："+t._s(e.item.count))]),t._v(" "),i("div",[t._v("尚可預約："+t._s(e.item.maxcount-e.item.count))])]),t._v(" "),i("div",{staticClass:"d-flex justify-end"},[i("v-btn",{staticClass:"cyan white--text",attrs:{depressed:""},on:{click:function(i){return t.reservationBtn_click(e.item.date)}}},[t._v("預約")])],1)]):t._e()])]}}],null,!1,1710393212)})]:t._e()],2)],1),t._v(" "),i("Confirm",{ref:"confirm"}),t._v(" "),i("v-overlay",{attrs:{value:t.running}},[i("v-progress-circular",{attrs:{indeterminate:"",size:"64"}},[t._v("執行中...")])],1)],1)};s._withStripped=!0;var n=i(407),a=i(425),c=i(426),r=i(400),o={mixins:[i(401).a],components:{Header:n.a,Calendar:a.a,Confirm:c.a},data:function(){return{cityList:[],cityValue:"",cityLoading:!1,siteList:[],siteValue:"",siteLoading:!1,currentDay:null,selectYear:null,selectMonth:null,running:!1,siteDateLoading:!1,api_citys_promise:null,api_searchSites_promise:null,api_searchOpentimes_promise:null,openDate:[]}},mounted:function(){var t=new Date;t.setDate(1),this.currentDay=t,this.selectYear=this.currentDay.getFullYear(),this.selectMonth=this.currentDay.getMonth()+1},methods:{city_click:function(){var t=this;this.api_citys_promise&&(this.api_citys_promise.cancel(),this.api_citys_promise=null),this.cityValue="",this.cityList=[],this.cityLoading=!0,this.api_citys_promise=Object(r.a)(this.$store.state.token),this.api_citys_promise.then((function(e){t.cityLoading=!1,t.cityList=e}))},city_change:function(){this.siteValue=""},site_click:function(){var t=this;this.api_searchSites_promise&&(this.api_searchSites_promise.cancel(),this.api_searchSites_promise=null),this.siteValue="",this.siteList=[],this.siteLoading=!0,this.api_searchSites_promise=Object(r.f)(this.$store.state.token,this.cityValue),this.api_searchSites_promise.then((function(e){t.siteLoading=!1,t.siteList=e.map((function(t){return{id:t.id,text:t.sitename}}))}))},updateStationDate:function(){var t=this,e=new Date("".concat(this.selectYear,"-").concat(this.selectMonth,"-1")),i=new Date("".concat(this.selectYear+(12===this.selectMonth?1:0),"-").concat((12===this.selectMonth?0:this.selectMonth)+1,"-1"));i.setDate(0),this.api_searchOpentimes_promise&&(this.api_searchOpentimes_promise.cancel(),this.api_searchOpentimes_promise=null),this.siteDateLoading=!0,this.api_searchOpentimes_promise=Object(r.e)(this.$store.state.token,this.cityValue,this.siteValue,e,i),this.api_searchOpentimes_promise.then((function(e){t.siteDateLoading=!1,t.openDate=e}))},prev:function(){this.currentDay.setFullYear(this.currentDay.getFullYear(),this.currentDay.getMonth()-1),this.selectYear=this.currentDay.getFullYear(),this.selectMonth=this.currentDay.getMonth()+1,this.updateStationDate()},next:function(){this.currentDay.setFullYear(this.currentDay.getFullYear(),this.currentDay.getMonth()+1),this.selectYear=this.currentDay.getFullYear(),this.selectMonth=this.currentDay.getMonth()+1,this.updateStationDate()},reservationBtn_click:function(t){var e=this;this.$refs.confirm.run("確定預約 ".concat(t," ?"),(function(){e.running=!0,Object(r.d)(e.$store.state.token,e.cityValue,e.siteValue,t).then((function(){e.running=!1,e.$store.dispatch("setReserv",{city:e.cityValue,site:e.siteValue,redate:t}),e.$router.push({name:"Extension"})})).catch((function(t){e.running=!1,e.errorAction(t)}))}),(function(){}))},site_change:function(){this.updateStationDate()}},computed:{}},l=(i(472),i(473),i(115)),u=Object(l.a)(o,s,[],!1,null,"2056fb8f",null);u.options.__file="src/vue/pages/Reservation.vue";e.default=u.exports}}]);